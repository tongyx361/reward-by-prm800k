nohup: ignoring input
[2023-08-15 02:23:11,102] [INFO] [real_accelerator.py:133:get_accelerator] Setting ds_accelerator to cuda (auto detect)
The following values were not passed to `accelerate launch` and had defaults used instead:
		More than one GPU was found, enabling multi-GPU training.
		If this was unintended please pass in `--num_processes=1`.
	`--dynamo_backend` was set to a value of `'no'`
To avoid this warning pass in values for each of the problematic parameters or run `accelerate config`.
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[2023-08-15 02:23:15,904] [INFO] [real_accelerator.py:133:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2023-08-15 02:23:15,915] [INFO] [real_accelerator.py:133:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2023-08-15 02:23:15,929] [INFO] [real_accelerator.py:133:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2023-08-15 02:23:15,932] [INFO] [real_accelerator.py:133:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2023-08-15 02:23:16,896] [WARNING] [comm.py:152:init_deepspeed_backend] NCCL backend in DeepSpeed not yet implemented
[2023-08-15 02:23:16,896] [INFO] [comm.py:616:init_distributed] cdb=None
[2023-08-15 02:23:16,899] [WARNING] [comm.py:152:init_deepspeed_backend] NCCL backend in DeepSpeed not yet implemented
[2023-08-15 02:23:16,899] [INFO] [comm.py:616:init_distributed] cdb=None
[2023-08-15 02:23:16,922] [WARNING] [comm.py:152:init_deepspeed_backend] NCCL backend in DeepSpeed not yet implemented
[2023-08-15 02:23:16,922] [INFO] [comm.py:616:init_distributed] cdb=None
[2023-08-15 02:23:16,946] [WARNING] [comm.py:152:init_deepspeed_backend] NCCL backend in DeepSpeed not yet implemented
[2023-08-15 02:23:16,947] [INFO] [comm.py:616:init_distributed] cdb=None
[2023-08-15 02:23:16,947] [INFO] [comm.py:643:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
08/15/2023 02:23:18 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 4
Process index: 1
Local process index: 1
Device: cuda:1

Mixed precision type: bf16
ds_config: {'bf16': {'enabled': True}, 'zero_optimization': {'stage': 3, 'offload_optimizer': {'device': 'cpu', 'pin_memory': True}, 'offload_param': {'device': 'cpu', 'pin_memory': True}, 'overlap_comm': True, 'contiguous_gradients': True, 'sub_group_size': 1000000000.0, 'reduce_bucket_size': 'auto', 'stage3_prefetch_bucket_size': 'auto', 'stage3_param_persistence_threshold': 'auto', 'stage3_max_live_parameters': 1000000000.0, 'stage3_max_reuse_distance': 1000000000.0, 'stage3_gather_16bit_weights_on_model_save': True}, 'gradient_accumulation_steps': 1, 'gradient_clipping': 'auto', 'steps_per_print': inf, 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'wall_clock_breakdown': False, 'fp16': {'enabled': False}}

08/15/2023 02:23:18 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 4
Process index: 0
Local process index: 0
Device: cuda:0

Mixed precision type: bf16
ds_config: {'bf16': {'enabled': True}, 'zero_optimization': {'stage': 3, 'offload_optimizer': {'device': 'cpu', 'pin_memory': True}, 'offload_param': {'device': 'cpu', 'pin_memory': True}, 'overlap_comm': True, 'contiguous_gradients': True, 'sub_group_size': 1000000000.0, 'reduce_bucket_size': 'auto', 'stage3_prefetch_bucket_size': 'auto', 'stage3_param_persistence_threshold': 'auto', 'stage3_max_live_parameters': 1000000000.0, 'stage3_max_reuse_distance': 1000000000.0, 'stage3_gather_16bit_weights_on_model_save': True}, 'gradient_accumulation_steps': 1, 'gradient_clipping': 'auto', 'steps_per_print': inf, 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'wall_clock_breakdown': False, 'fp16': {'enabled': False}}

08/15/2023 02:23:18 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 4
Process index: 3
Local process index: 3
Device: cuda:3

Mixed precision type: bf16
ds_config: {'bf16': {'enabled': True}, 'zero_optimization': {'stage': 3, 'offload_optimizer': {'device': 'cpu', 'pin_memory': True}, 'offload_param': {'device': 'cpu', 'pin_memory': True}, 'overlap_comm': True, 'contiguous_gradients': True, 'sub_group_size': 1000000000.0, 'reduce_bucket_size': 'auto', 'stage3_prefetch_bucket_size': 'auto', 'stage3_param_persistence_threshold': 'auto', 'stage3_max_live_parameters': 1000000000.0, 'stage3_max_reuse_distance': 1000000000.0, 'stage3_gather_16bit_weights_on_model_save': True}, 'gradient_accumulation_steps': 1, 'gradient_clipping': 'auto', 'steps_per_print': inf, 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'wall_clock_breakdown': False, 'fp16': {'enabled': False}}

08/15/2023 02:23:18 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 4
Process index: 2
Local process index: 2
Device: cuda:2

Mixed precision type: bf16
ds_config: {'bf16': {'enabled': True}, 'zero_optimization': {'stage': 3, 'offload_optimizer': {'device': 'cpu', 'pin_memory': True}, 'offload_param': {'device': 'cpu', 'pin_memory': True}, 'overlap_comm': True, 'contiguous_gradients': True, 'sub_group_size': 1000000000.0, 'reduce_bucket_size': 'auto', 'stage3_prefetch_bucket_size': 'auto', 'stage3_param_persistence_threshold': 'auto', 'stage3_max_live_parameters': 1000000000.0, 'stage3_max_reuse_distance': 1000000000.0, 'stage3_gather_16bit_weights_on_model_save': True}, 'gradient_accumulation_steps': 1, 'gradient_clipping': 'auto', 'steps_per_print': inf, 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'wall_clock_breakdown': False, 'fp16': {'enabled': False}}

loading configuration file config.json from cache at /data/users/zhangjunlei/tyx/.cache/huggingface/hub/models--meta-llama--Llama-2-7b-hf/snapshots/6fdf2e60f86ff2481f2241aaee459f85b5b0bbb9/config.json
Model config LlamaConfig {
  "_name_or_path": "meta-llama/Llama-2-7b-hf",
  "architectures": [
    "LlamaForCausalLM"
  ],
  "bos_token_id": 1,
  "eos_token_id": 2,
  "hidden_act": "silu",
  "hidden_size": 4096,
  "initializer_range": 0.02,
  "intermediate_size": 11008,
  "max_position_embeddings": 4096,
  "model_type": "llama",
  "num_attention_heads": 32,
  "num_hidden_layers": 32,
  "num_key_value_heads": 32,
  "pad_token_id": 0,
  "pretraining_tp": 1,
  "rms_norm_eps": 1e-05,
  "rope_scaling": null,
  "tie_word_embeddings": false,
  "torch_dtype": "float16",
  "transformers_version": "4.31.0",
  "use_cache": true,
  "vocab_size": 32000
}

loading file tokenizer.model from cache at /data/users/zhangjunlei/tyx/.cache/huggingface/hub/models--meta-llama--Llama-2-7b-hf/snapshots/6fdf2e60f86ff2481f2241aaee459f85b5b0bbb9/tokenizer.model
loading file added_tokens.json from cache at None
loading file special_tokens_map.json from cache at /data/users/zhangjunlei/tyx/.cache/huggingface/hub/models--meta-llama--Llama-2-7b-hf/snapshots/6fdf2e60f86ff2481f2241aaee459f85b5b0bbb9/special_tokens_map.json
loading file tokenizer_config.json from cache at /data/users/zhangjunlei/tyx/.cache/huggingface/hub/models--meta-llama--Llama-2-7b-hf/snapshots/6fdf2e60f86ff2481f2241aaee459f85b5b0bbb9/tokenizer_config.json
loading weights file model.safetensors from cache at /data/users/zhangjunlei/tyx/.cache/huggingface/hub/models--meta-llama--Llama-2-7b-hf/snapshots/6fdf2e60f86ff2481f2241aaee459f85b5b0bbb9/model.safetensors.index.json
Detected DeepSpeed ZeRO-3: activating zero.init() for this model
Generate config GenerationConfig {
  "_from_model_config": true,
  "bos_token_id": 1,
  "eos_token_id": 2,
  "pad_token_id": 0,
  "transformers_version": "4.31.0"
}

[2023-08-15 02:23:27,695] [INFO] [partition_parameters.py:326:__exit__] finished initializing model with 6.74B parameters
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.67s/it]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.68s/it]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.69s/it]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.97s/it]
Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.97s/it]
Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.98s/it]
Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.00s/it]
All model checkpoint weights were used when initializing LlamaForCausalLM.

All the weights of LlamaForCausalLM were initialized from the model checkpoint at meta-llama/Llama-2-7b-hf.
If your task is similar to the task the model of the checkpoint was trained on, you can already use LlamaForCausalLM for predictions without further training.
loading configuration file generation_config.json from cache at /data/users/zhangjunlei/tyx/.cache/huggingface/hub/models--meta-llama--Llama-2-7b-hf/snapshots/6fdf2e60f86ff2481f2241aaee459f85b5b0bbb9/generation_config.json
Generate config GenerationConfig {
  "bos_token_id": 1,
  "do_sample": true,
  "eos_token_id": 2,
  "max_length": 4096,
  "pad_token_id": 0,
  "temperature": 0.6,
  "top_p": 0.9,
  "transformers_version": "4.31.0"
}

Assigning <s> to the bos_token key of the tokenizer
Assigning </s> to the eos_token key of the tokenizer
Assigning <unk> to the unk_token key of the tokenizer
Assigning <pad> to the pad_token key of the tokenizer
Adding <pad> to the vocabulary
08/15/2023 02:23:37 - INFO - __main__ - Sample 10491 of the training set: {'input_ids': tensor([    1,   960,   395, 29896,   320,   280,   263,   320,   280, 29871,
        29896, 29900, 29938,   322,   395, 29896,   320,   280,   289,   320,
          280, 29871, 29941, 29953,  1628,   363,   920,  1784, 10372, 11000,
          310, 11920,  2427, 29874, 29892,   289,  1262,   338,   779,  3676,
        29912, 29874,   718,   320,  3676, 29912, 29890,  7920,   385,  6043,
        29973,    13, 29902,  8369,   393,   779,  3676, 29912, 29874,   718,
          320,  3676, 29912, 29890,  7920,   338,   385,  6043,   871,   565,
          395, 29874,   718,   320,  3676, 29912, 29890,  1042,   338,   263,
         4922,  6862, 29889,    13,  6295,   306,   864,   304,  1284,   599,
          278,  1950,  1819,   310,   395, 29874, 29938,   322,   395, 29890,
        29938,   393,  1207,   395, 29874,   718,   320,  3676, 29912, 29890,
         1042,   263,  4922,  6862, 29889,    13, 29902,   508,  1369,   491,
        18028,   777,  4922, 25256, 29901,   395, 29896, 29892, 29871, 29946,
        29892, 29871, 29929, 29892, 29871, 29896, 29953, 29892, 29871, 29906,
        29945, 29892, 29871, 29941, 29953, 29892, 29871, 29946, 29929, 29892,
        29871, 29953, 29946, 29892, 29871, 29947, 29896, 29892, 29871, 29896,
        29900, 29900, 29892,   320,  7778,  1504,    13, 29902,  1074,   393,
          278, 10150,  1950,   995,   310,   395, 29874,   718,   320,  3676,
        29912, 29890,  1042,   338,   395, 29896, 29900,   718,   320,  3676,
        29912, 29941, 29953, 29913,   353, 29871, 29896, 29953,  1628,   577,
          306,   508, 11455,   738,  4922, 25256,  7200,  1135, 29871, 29896,
        29953, 29889,    13, 29902,   884,  1074,   393,   278, 19087,  1950,
          995,   310,   395, 29874,   718,   320,  3676, 29912, 29890,  1042,
          338,   395, 29896,   718,   320,  3676, 29912, 29896, 29913,   353,
        29871, 29906,  1628,   577,   306,   508, 11455,   738,  4922, 25256,
         7968,  1135, 29871, 29906, 29889,    13,  7058, 11308,   592,   411,
          395, 29946, 29892, 29871, 29929,  1628,   322,   395, 29896, 29953,
        29938,   408,   278,  1950,  1819,   310,   395, 29874,   718,   320,
         3676, 29912, 29890,  4311,    13]), 'labels': tensor([-100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, 6374,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, 6374, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, 6374, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, 6374, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, 6374, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, 8178]), 'attention_mask': tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1])}.
08/15/2023 02:23:37 - INFO - __main__ - Sample 47447 of the training set: {'input_ids': tensor([    1,   450,  5665,   395, 29953, 29900, 29955, 29945, 29892, 29871,
        29906, 29900, 29906, 29945, 29892, 29871, 29953, 29955, 29945,   320,
         7796,  1628,   338,  1754,   491, 28424,  1933,  4821,   491, 29871,
        29941, 29889,  1128,  1784, 11920,   526,   297,   445,  5665, 29973,
           13, 29902,   817,   304,  1284,   714,   746,   445,  5665, 17726,
        29892,   393,   338, 29892,   746,   278,  2446,  1840,   338,   451,
          385,  6043, 15128, 29889,    13, 29902,   508,  2436,   278,  2498,
         1840,   310,   445,  5665,   408,   395, 29874, 29918, 29876,   353,
        29871, 29953, 29900, 29955, 29945, 29914, 29941, 29985, 29876,  1628,
          988,   395, 29876, 29938,   338,   278,  1353,   310,  3064,   306,
        16429,   491, 29871, 29941, 29892,  6257,   515,   395, 29876,   353,
        29871, 29900, 29938,   363,   278,   937,  1840, 29889,    13,  1762,
          505,   385,  6043,  1840, 29892,   395, 29874, 29918, 29876, 29938,
         1818,   367,  8572,  1821,   491, 29871, 29941, 29892,   607,  2794,
          393,   395, 29953, 29900, 29955, 29945, 29914, 29941, 29985, 29876,
        29938,  1818,   367,  8572,  1821,   491, 29871, 29941, 29892,   470,
         5737,  2705, 29892,   393,   395, 29953, 29900, 29955, 29945, 29914,
        29941,   998, 29876, 29974, 29896,  1042,  1818,   367,   385,  6043,
        29889,    13]), 'labels': tensor([-100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, 6374, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, 6374, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, 8178]), 'attention_mask': tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1])}.
08/15/2023 02:23:37 - INFO - __main__ - Sample 34944 of the training set: {'input_ids': tensor([    1,  2803,   395, 29940, 29938,   367,   278, 14176,  6043,  2999,
          310, 29871, 29947, 29892,   694,  1023,   310,  5069, 13340,   526,
          278,  1021, 29889,  1724,   338,   278, 21162,   746,   395, 29940,
        29938,   338, 13931,   491, 29871, 29896, 29900, 29900, 29900, 29973,
           13, 29902,   817,   304,  1284,   278, 10150,  2999,   310, 29871,
        29947,   393,   756,   694, 10324, 13340, 29889,    13, 29902,  1073,
          393,   263,  1353,   338,  8572,  1821,   491, 29871, 29947,   565,
          278,  1833,  2211, 13340,   526,  8572,  1821,   491, 29871, 29947,
        29892,   577,   306,   508,  8569,   373,   278,  1833,  2211, 13340,
          937, 29889,    13,  1576, 10150,  2211, 29899, 26204,  1353,  8572,
         1821,   491, 29871, 29947,   338, 29871, 29929, 29929, 29906, 29892,
          541,   372,   756,  1023, 29871, 29929, 29879, 29892,   577,   306,
          817,   304,  5224,   372, 29889,    13]), 'labels': tensor([-100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, 6374, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, 6374, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100,
        -100, -100, -100, -100, -100, 8178]), 'attention_mask': tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1])}.
08/15/2023 02:23:37 - INFO - accelerate.accelerator - Updating DeepSpeed's gradient accumulation steps to 16 from 1.
Installed CUDA version 11.3 does not match the version torch was compiled with 11.7 but since the APIs are compatible, accepting this combination
Installed CUDA version 11.3 does not match the version torch was compiled with 11.7 but since the APIs are compatible, accepting this combination
Installed CUDA version 11.3 does not match the version torch was compiled with 11.7 but since the APIs are compatible, accepting this combination
Installed CUDA version 11.3 does not match the version torch was compiled with 11.7 but since the APIs are compatible, accepting this combination
Installed CUDA version 11.3 does not match the version torch was compiled with 11.7 but since the APIs are compatible, accepting this combination
Using /data/users/zhangjunlei/.cache/torch_extensions/py310_cu117 as PyTorch extensions root...
Detected CUDA files, patching ldflags
Emitting ninja build file /data/users/zhangjunlei/.cache/torch_extensions/py310_cu117/cpu_adam/build.ninja...
Building extension module cpu_adam...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module cpu_adam...
Time to load cpu_adam op: 0.29156994819641113 seconds
Installed CUDA version 11.3 does not match the version torch was compiled with 11.7 but since the APIs are compatible, accepting this combination
Using /data/users/zhangjunlei/.cache/torch_extensions/py310_cu117 as PyTorch extensions root...
Installed CUDA version 11.3 does not match the version torch was compiled with 11.7 but since the APIs are compatible, accepting this combination
Using /data/users/zhangjunlei/.cache/torch_extensions/py310_cu117 as PyTorch extensions root...
Detected CUDA files, patching ldflags
Emitting ninja build file /data/users/zhangjunlei/.cache/torch_extensions/py310_cu117/cpu_adam/build.ninja...
Building extension module cpu_adam...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
Installed CUDA version 11.3 does not match the version torch was compiled with 11.7 but since the APIs are compatible, accepting this combination
Using /data/users/zhangjunlei/.cache/torch_extensions/py310_cu117 as PyTorch extensions root...
ninja: no work to do.
Loading extension module cpu_adam...
Time to load cpu_adam op: 0.29193544387817383 seconds
Loading extension module cpu_adam...
Time to load cpu_adam op: 0.3319058418273926 seconds
Loading extension module cpu_adam...
Time to load cpu_adam op: 0.3274691104888916 seconds
Adam Optimizer #0 is created with AVX512 arithmetic capability.
Config: alpha=0.000020, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
08/15/2023 02:23:40 - INFO - torch.distributed.distributed_c10d - Added key: store_based_barrier_key:2 to store for rank: 3
Adam Optimizer #0 is created with AVX512 arithmetic capability.
Config: alpha=0.000020, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
Adam Optimizer #0 is created with AVX512 arithmetic capability.
Config: alpha=0.000020, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
Adam Optimizer #0 is created with AVX512 arithmetic capability.
Config: alpha=0.000020, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
[2023-08-15 02:23:41,080] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed info: version=0.10.0, git-hash=unknown, git-branch=unknown
08/15/2023 02:23:41 - INFO - torch.distributed.distributed_c10d - Added key: store_based_barrier_key:2 to store for rank: 1
08/15/2023 02:23:41 - INFO - torch.distributed.distributed_c10d - Added key: store_based_barrier_key:2 to store for rank: 2
08/15/2023 02:23:41 - INFO - torch.distributed.distributed_c10d - Added key: store_based_barrier_key:2 to store for rank: 0
08/15/2023 02:23:41 - INFO - torch.distributed.distributed_c10d - Rank 0: Completed store-based barrier for key:store_based_barrier_key:2 with 4 nodes.
08/15/2023 02:23:41 - INFO - torch.distributed.distributed_c10d - Rank 1: Completed store-based barrier for key:store_based_barrier_key:2 with 4 nodes.
08/15/2023 02:23:41 - INFO - torch.distributed.distributed_c10d - Rank 3: Completed store-based barrier for key:store_based_barrier_key:2 with 4 nodes.
08/15/2023 02:23:41 - INFO - torch.distributed.distributed_c10d - Rank 2: Completed store-based barrier for key:store_based_barrier_key:2 with 4 nodes.
[2023-08-15 02:23:41,907] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-15 02:23:41,908] [INFO] [logging.py:96:log_dist] [Rank 0] Removing param_group that has no 'params' in the client Optimizer
[2023-08-15 02:23:41,908] [INFO] [logging.py:96:log_dist] [Rank 0] Using client Optimizer as basic optimizer
[2023-08-15 02:23:41,918] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Basic Optimizer = DeepSpeedCPUAdam
[2023-08-15 02:23:41,918] [INFO] [utils.py:54:is_zero_supported_optimizer] Checking ZeRO support for optimizer=DeepSpeedCPUAdam type=<class 'deepspeed.ops.adam.cpu_adam.DeepSpeedCPUAdam'>
[2023-08-15 02:23:41,918] [INFO] [logging.py:96:log_dist] [Rank 0] Creating fp16 ZeRO stage 3 optimizer, MiCS is enabled False, Hierarchical params gather False
[2023-08-15 02:23:41,918] [INFO] [logging.py:96:log_dist] [Rank 0] Creating torch.bfloat16 ZeRO stage 3 optimizer
[2023-08-15 02:23:42,013] [INFO] [utils.py:785:see_memory_usage] Stage 3 initialize beginning
[2023-08-15 02:23:42,013] [INFO] [utils.py:786:see_memory_usage] MA 0.55 GB         Max_MA 1.1 GB         CA 1.78 GB         Max_CA 2 GB 
[2023-08-15 02:23:42,013] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 105.09 GB, percent = 10.4%
[2023-08-15 02:23:42,015] [INFO] [stage3.py:117:__init__] Reduce bucket size 16777216
[2023-08-15 02:23:42,015] [INFO] [stage3.py:118:__init__] Prefetch bucket size 15099494
[2023-08-15 02:23:42,107] [INFO] [utils.py:785:see_memory_usage] DeepSpeedZeRoOffload initialize [begin]
[2023-08-15 02:23:42,107] [INFO] [utils.py:786:see_memory_usage] MA 0.55 GB         Max_MA 0.55 GB         CA 1.78 GB         Max_CA 2 GB 
[2023-08-15 02:23:42,107] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 105.09 GB, percent = 10.4%
Parameter Offload: Total persistent parameters: 266240 in 65 params
[2023-08-15 02:23:42,279] [INFO] [utils.py:785:see_memory_usage] DeepSpeedZeRoOffload initialize [end]
[2023-08-15 02:23:42,280] [INFO] [utils.py:786:see_memory_usage] MA 0.06 GB         Max_MA 0.55 GB         CA 1.78 GB         Max_CA 2 GB 
[2023-08-15 02:23:42,280] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 105.22 GB, percent = 10.4%
[2023-08-15 02:23:42,370] [INFO] [utils.py:785:see_memory_usage] Before creating fp16 partitions
[2023-08-15 02:23:42,370] [INFO] [utils.py:786:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.78 GB         Max_CA 2 GB 
[2023-08-15 02:23:42,370] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 105.22 GB, percent = 10.4%
[2023-08-15 02:23:45,303] [INFO] [utils.py:785:see_memory_usage] After creating fp16 partitions: 2
[2023-08-15 02:23:45,304] [INFO] [utils.py:786:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.78 GB         Max_CA 2 GB 
[2023-08-15 02:23:45,304] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 122.08 GB, percent = 12.1%
[2023-08-15 02:23:45,390] [INFO] [utils.py:785:see_memory_usage] Before creating fp32 partitions
[2023-08-15 02:23:45,391] [INFO] [utils.py:786:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.78 GB         Max_CA 2 GB 
[2023-08-15 02:23:45,391] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 122.73 GB, percent = 12.2%
[2023-08-15 02:23:47,366] [INFO] [utils.py:785:see_memory_usage] After creating fp32 partitions
[2023-08-15 02:23:47,367] [INFO] [utils.py:786:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.78 GB         Max_CA 2 GB 
[2023-08-15 02:23:47,367] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 142.14 GB, percent = 14.1%
[2023-08-15 02:23:49,027] [INFO] [utils.py:785:see_memory_usage] Before initializing optimizer states
[2023-08-15 02:23:49,028] [INFO] [utils.py:786:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.78 GB         Max_CA 2 GB 
[2023-08-15 02:23:49,028] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 147.65 GB, percent = 14.7%
[2023-08-15 02:23:59,535] [INFO] [utils.py:785:see_memory_usage] After initializing optimizer states
[2023-08-15 02:23:59,535] [INFO] [utils.py:786:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.78 GB         Max_CA 2 GB 
[2023-08-15 02:23:59,535] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 226.32 GB, percent = 22.5%
[2023-08-15 02:24:04,823] [INFO] [stage3.py:424:_setup_for_real_optimizer] optimizer state initialized
[2023-08-15 02:24:10,055] [INFO] [utils.py:785:see_memory_usage] After initializing ZeRO optimizer
[2023-08-15 02:24:10,055] [INFO] [utils.py:786:see_memory_usage] MA 0.09 GB         Max_MA 0.58 GB         CA 2.02 GB         Max_CA 2 GB 
[2023-08-15 02:24:10,056] [INFO] [utils.py:793:see_memory_usage] CPU Virtual Memory:  used = 246.33 GB, percent = 24.5%
[2023-08-15 02:24:10,056] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Final Optimizer = DeepSpeedCPUAdam
[2023-08-15 02:24:10,056] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed using client LR scheduler
[2023-08-15 02:24:10,056] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed LR Scheduler = None
[2023-08-15 02:24:10,056] [INFO] [logging.py:96:log_dist] [Rank 0] step=0, skipped=0, lr=[0.0], mom=[(0.9, 0.999)]
[2023-08-15 02:24:10,057] [INFO] [config.py:960:print] DeepSpeedEngine configuration:
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   amp_enabled .................. False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   amp_params ................... False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   bfloat16_enabled ............. True
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   checkpoint_parallel_write_pipeline  False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   checkpoint_tag_validation_enabled  True
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   checkpoint_tag_validation_fail  False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fe8625d11e0>
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   communication_data_type ...... None
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   curriculum_enabled_legacy .... False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   curriculum_params_legacy ..... False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   data_efficiency_enabled ...... False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   dataloader_drop_last ......... False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   disable_allgather ............ False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   dump_state ................... False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   dynamic_loss_scale_args ...... None
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   eigenvalue_enabled ........... False
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   eigenvalue_layer_num ......... 0
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   eigenvalue_max_iter .......... 100
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   eigenvalue_stability ......... 1e-06
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   eigenvalue_tol ............... 0.01
[2023-08-15 02:24:10,057] [INFO] [config.py:964:print]   eigenvalue_verbose ........... False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   elasticity_enabled ........... False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   flops_profiler_config ........ {
    "enabled": false, 
    "recompute_fwd_factor": 0.0, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   fp16_auto_cast ............... None
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   fp16_enabled ................. False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   fp16_master_weights_and_gradients  False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   global_rank .................. 0
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   grad_accum_dtype ............. None
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   gradient_accumulation_steps .. 16
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   gradient_clipping ............ 1.0
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   gradient_predivide_factor .... 1.0
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   hybrid_engine ................ enabled=False max_out_tokens=512 inference_tp_size=1 release_inference_cache=False pin_parameters=True tp_gather_partition_size=8
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   initial_dynamic_scale ........ 1
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   load_universal_checkpoint .... False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   loss_scale ................... 1.0
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   memory_breakdown ............. False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   mics_hierarchial_params_gather  False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   mics_shard_size .............. -1
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   monitor_config ............... tensorboard=TensorBoardConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') wandb=WandbConfig(enabled=False, group=None, team=None, project='deepspeed') csv_monitor=CSVConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') enabled=False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   optimizer_legacy_fusion ...... False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   optimizer_name ............... None
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   optimizer_params ............. None
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   pld_enabled .................. False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   pld_params ................... False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   prescale_gradients ........... False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   scheduler_name ............... None
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   scheduler_params ............. None
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   sparse_attention ............. None
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   sparse_gradients_enabled ..... False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   steps_per_print .............. inf
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   train_batch_size ............. 128
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   train_micro_batch_size_per_gpu  2
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   use_node_local_storage ....... False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   wall_clock_breakdown ......... False
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   world_size ................... 4
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   zero_allow_untested_optimizer  True
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   zero_config .................. stage=3 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=16777216 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=True load_from_fp32_weights=True elastic_checkpoint=False offload_param=DeepSpeedZeroOffloadParamConfig(device='cpu', nvme_path=None, buffer_count=5, buffer_size=100,000,000, max_in_cpu=1,000,000,000, pin_memory=True) offload_optimizer=DeepSpeedZeroOffloadOptimizerConfig(device='cpu', nvme_path=None, buffer_count=4, pin_memory=True, pipeline=False, pipeline_read=False, pipeline_write=False, fast_init=False) sub_group_size=1000000000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=15099494 param_persistence_threshold=40960 model_persistence_threshold=sys.maxsize max_live_parameters=1000000000 max_reuse_distance=1000000000 gather_16bit_weights_on_model_save=True stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False zero_hpz_partition_size=1 zero_quantized_weights=False zero_quantized_gradients=False mics_shard_size=-1 mics_hierarchical_params_gather=False memory_efficient_linear=True
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   zero_enabled ................. True
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   zero_force_ds_cpu_optimizer .. True
[2023-08-15 02:24:10,058] [INFO] [config.py:964:print]   zero_optimization_stage ...... 3
[2023-08-15 02:24:10,058] [INFO] [config.py:950:print_user_config]   json = {
    "bf16": {
        "enabled": true
    }, 
    "zero_optimization": {
        "stage": 3, 
        "offload_optimizer": {
            "device": "cpu", 
            "pin_memory": true
        }, 
        "offload_param": {
            "device": "cpu", 
            "pin_memory": true
        }, 
        "overlap_comm": true, 
        "contiguous_gradients": true, 
        "sub_group_size": 1.000000e+09, 
        "reduce_bucket_size": 1.677722e+07, 
        "stage3_prefetch_bucket_size": 1.509949e+07, 
        "stage3_param_persistence_threshold": 4.096000e+04, 
        "stage3_max_live_parameters": 1.000000e+09, 
        "stage3_max_reuse_distance": 1.000000e+09, 
        "stage3_gather_16bit_weights_on_model_save": true
    }, 
    "gradient_accumulation_steps": 16, 
    "gradient_clipping": 1.0, 
    "steps_per_print": inf, 
    "train_batch_size": 128, 
    "train_micro_batch_size_per_gpu": 2, 
    "wall_clock_breakdown": false, 
    "fp16": {
        "enabled": false
    }, 
    "zero_allow_untested_optimizer": true
}
08/15/2023 02:24:10 - INFO - __main__ - ***** Running training *****
08/15/2023 02:24:10 - INFO - __main__ -   Num examples = 87012
08/15/2023 02:24:10 - INFO - __main__ -   Num Epochs = 3
08/15/2023 02:24:10 - INFO - __main__ -   Instantaneous batch size per device = 2
08/15/2023 02:24:10 - INFO - __main__ -   Total train batch size (w. parallel, distributed & accumulation) = 128
08/15/2023 02:24:10 - INFO - __main__ -   Gradient Accumulation steps = 16
08/15/2023 02:24:10 - INFO - __main__ -   Total optimization steps = 2040
  0%|          | 0/2040 [00:00<?, ?it/s]Traceback (most recent call last):
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 731, in convert_to_tensors
    tensor = as_tensor(value)
ValueError: expected sequence of length 4096 at dim 1 (got 4111)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/data/users/zhangjunlei/tyx/reward-by-prm800k/open-instruct/open_instruct/finetune.py", line 1007, in <module>
Traceback (most recent call last):
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 731, in convert_to_tensors
    main()
  File "/data/users/zhangjunlei/tyx/reward-by-prm800k/open-instruct/open_instruct/finetune.py", line 916, in main
    tensor = as_tensor(value)
ValueError: expected sequence of length 4198 at dim 1 (got 4096)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/data/users/zhangjunlei/tyx/reward-by-prm800k/open-instruct/open_instruct/finetune.py", line 1007, in <module>
    for step, batch in enumerate(train_dataloader):
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/accelerate/data_loader.py", line 384, in __iter__
        current_batch = next(dataloader_iter)main()Traceback (most recent call last):


  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 633, in __next__
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 731, in convert_to_tensors
  File "/data/users/zhangjunlei/tyx/reward-by-prm800k/open-instruct/open_instruct/finetune.py", line 916, in main
    data = self._next_data()
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 677, in _next_data
    for step, batch in enumerate(train_dataloader):
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/accelerate/data_loader.py", line 384, in __iter__
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/_utils/fetch.py", line 54, in fetch
    tensor = as_tensor(value)
ValueError    : current_batch = next(dataloader_iter)expected sequence of length 4281 at dim 1 (got 4096)
    
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 633, in __next__
return self.collate_fn(data)
The above exception was the direct cause of the following exception:


Traceback (most recent call last):
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/data/data_collator.py", line 586, in __call__
  File "/data/users/zhangjunlei/tyx/reward-by-prm800k/open-instruct/open_instruct/finetune.py", line 1007, in <module>
    data = self._next_data()
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 677, in _next_data
    features = self.tokenizer.pad(
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 3074, in pad
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/_utils/fetch.py", line 54, in fetch
    main()
  File "/data/users/zhangjunlei/tyx/reward-by-prm800k/open-instruct/open_instruct/finetune.py", line 916, in main
    return self.collate_fn(data)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/data/data_collator.py", line 586, in __call__
    features = self.tokenizer.pad(
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 3074, in pad
    for step, batch in enumerate(train_dataloader):
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/accelerate/data_loader.py", line 384, in __iter__
    current_batch = next(dataloader_iter)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 633, in __next__
    return BatchEncoding(batch_outputs, tensor_type=return_tensors)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 211, in __init__
    data = self._next_data()    
self.convert_to_tensors(tensor_type=tensor_type, prepend_batch_axis=prepend_batch_axis)  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 677, in _next_data

  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 747, in convert_to_tensors
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/_utils/fetch.py", line 54, in fetch
    raise ValueError(
ValueError: Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' 'truncation=True' to have batched tensors with the same length. Perhaps your features (`labels` in this case) have excessive nesting (inputs type `list` where type `int` is expected).Traceback (most recent call last):

    return self.collate_fn(data)  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 731, in convert_to_tensors
    
return BatchEncoding(batch_outputs, tensor_type=return_tensors)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/data/data_collator.py", line 586, in __call__
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 211, in __init__
    self.convert_to_tensors(tensor_type=tensor_type, prepend_batch_axis=prepend_batch_axis)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 747, in convert_to_tensors
    features = self.tokenizer.pad(
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 3074, in pad
    raise ValueError(
ValueError: Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' 'truncation=True' to have batched tensors with the same length. Perhaps your features (`labels` in this case) have excessive nesting (inputs type `list` where type `int` is expected).
    tensor = as_tensor(value)
ValueError: expected sequence of length 4096 at dim 1 (got 4303)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/data/users/zhangjunlei/tyx/reward-by-prm800k/open-instruct/open_instruct/finetune.py", line 1007, in <module>
    return BatchEncoding(batch_outputs, tensor_type=return_tensors)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 211, in __init__
    main()
  File "/data/users/zhangjunlei/tyx/reward-by-prm800k/open-instruct/open_instruct/finetune.py", line 916, in main
    self.convert_to_tensors(tensor_type=tensor_type, prepend_batch_axis=prepend_batch_axis)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 747, in convert_to_tensors
    raise ValueError(
ValueError: Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' 'truncation=True' to have batched tensors with the same length. Perhaps your features (`labels` in this case) have excessive nesting (inputs type `list` where type `int` is expected).
    for step, batch in enumerate(train_dataloader):
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/accelerate/data_loader.py", line 384, in __iter__
    current_batch = next(dataloader_iter)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 633, in __next__
    data = self._next_data()
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 677, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/utils/data/_utils/fetch.py", line 54, in fetch
    return self.collate_fn(data)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/data/data_collator.py", line 586, in __call__
    features = self.tokenizer.pad(
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 3074, in pad
    return BatchEncoding(batch_outputs, tensor_type=return_tensors)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 211, in __init__
    self.convert_to_tensors(tensor_type=tensor_type, prepend_batch_axis=prepend_batch_axis)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 747, in convert_to_tensors
    raise ValueError(
ValueError: Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' 'truncation=True' to have batched tensors with the same length. Perhaps your features (`labels` in this case) have excessive nesting (inputs type `list` where type `int` is expected).
  0%|          | 0/2040 [00:00<?, ?it/s]
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 735103 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 735104 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 735105 closing signal SIGTERM
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 735102) of binary: /data/users/zhangjunlei/anaconda3/envs/open-instruct/bin/python
Traceback (most recent call last):
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/bin/accelerate", line 8, in <module>
    sys.exit(main())
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/accelerate/commands/accelerate_cli.py", line 45, in main
    args.func(args)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/accelerate/commands/launch.py", line 964, in launch_command
    deepspeed_launcher(args)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/accelerate/commands/launch.py", line 687, in deepspeed_launcher
    distrib_run.run(args)
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/distributed/run.py", line 785, in run
    elastic_launch(
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 134, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/data/users/zhangjunlei/anaconda3/envs/open-instruct/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 250, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/data/users/zhangjunlei/tyx/reward-by-prm800k/open-instruct/open_instruct/finetune.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-15_02:24:17
  host      : a100
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 735102)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
